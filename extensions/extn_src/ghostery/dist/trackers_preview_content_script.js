typeof browser<"u"&&(chrome=browser),(()=>{"use strict";var W={};const p={advertising:" #CB55CD",site_analytics:"#87D7EF",consent:"#556FCD",essential:"#FC9734",hosting:"#8459A5",customer_interaction:"#EF671E",unidentified:"#E8E8E8",audio_video_player:"#4ECB4E",cdn:"#4ECBA1",comments:"#4EA1CB",email:"#4E4ECB",extensions:"#A14ECB",misc:"#CB4EA1",pornvertising:"#CB4E4E",social_media:"#CBA14E",telemetry:"#A1CB4E"},h=["advertising","site_analytics","consent","essential","hosting","customer_interaction","audio_video_player","cdn","comments","email","extensions","misc","pornvertising","social_media","telemetry","unidentified"],d=e=>p[e]?e:"unidentified",v=e=>p[d(e)],_=(e=n=>n)=>(n,i)=>{const t=d(e(n)),r=d(e(i));return h.indexOf(t)-h.indexOf(r)};function E(e){const n=Math.PI/180;return e*n}function g(e,n,i,t=!0){if(t&&typeof window<"u"){const{canvas:a}=e;a.style.width=n+"px",a.style.height=n+"px";const c=window.devicePixelRatio;a.width=Math.floor(n*c),a.height=Math.floor(n*c),e.scale(c,c)}const r={};h.forEach(a=>r[d(a)]=0),i.forEach(a=>r[d(a)]+=1);const o=n/2,l=360/i.length;e.lineWidth=Math.floor(n*.14)*.95;const s=n/2-e.lineWidth;e.strokeStyle="blue",e.beginPath(),e.arc(o,o,Math.floor(s),0,2*Math.PI),e.stroke(),e.lineWidth=n*.14;let f=-90;for(const[a,c]of Object.entries(r))if(c>0){const C=f+c*l,R=v(a);e.strokeStyle=R,e.beginPath(),e.arc(o,o,s,E(f),Math.min(E(C+1),2*Math.PI)),e.stroke(),f=C}}function T(e,n){let i;try{i=new OffscreenCanvas(e,e)}catch{i=document.createElement("canvas"),i.width=e,i.height=e}const t=i.getContext("2d");return g(t,e,n,!1),t.getImageData(0,0,e,e)}const u="wtm-popup-iframe-wrapper",y=/iPhone|iPad|iPod|Android/i.test(navigator.userAgent);function m(){[...document.querySelectorAll(`.${u}`)].forEach(e=>{e.parentElement.removeChild(e)})}function P(e){[...document.querySelectorAll(`.${u}`)].forEach(n=>{n.style.height=`${e}px`})}const w=e=>e.offsetTop+(e.offsetParent&&w(e.offsetParent));function b(e,n,i){m();const t=document.createElement("div");if(t.classList.add(u),y)t.style.width=window.innerWidth-20+"px",t.style.left="10px";else{const o=e.getBoundingClientRect().left-175+12;t.style.left=(o<20?20:o)+"px"}t.style.top=w(e)+25+"px";const r=document.createElement("iframe");r.setAttribute("src",`${i}?domain=${n.domain}`),t.appendChild(r),document.body.appendChild(t)}function k(e,n){const i=e.stats.length;if(i===0)return null;const t=document.createElement("div");t.classList.add("wtm-tracker-wheel-container");const r=document.createElement("label");r.innerText=i;const o=document.createElement("canvas");o.classList.add("wtm-tracker-wheel");const l=o.getContext("2d");return g(l,16,e.stats),t.appendChild(o),t.appendChild(r),t.addEventListener("click",s=>{s.preventDefault(),s.stopImmediatePropagation(),b(t,e,n)}),t}function M(e){const n=e.parentElement.querySelector(".wtm-tracker-wheel-container");n&&n.parentElement.removeChild(n)}function A(e){const n=[...window.document.querySelectorAll("[data-hveid] div.yuRUbf > a, [data-hveid] div.xpd a.cz3goc, [data-hveid] > .xpd > div.kCrYT:first-child > a")];if(n.length){const i=n.map(t=>{if(t.hostname===window.location.hostname){const r=new URL(t.href);return r.searchParams.get("url")||r.searchParams.get("q")}return t.href});chrome.runtime.sendMessage({action:"getWTMReport",links:i},t=>{if(chrome.runtime.lastError){console.error("Could not retrieve WTM information on URLs",chrome.runtime.lastError);return}document.addEventListener("click",r=>{let o=r.target;for(;o&&!o.href;)o=o.parentElement;o&&m()}),n.forEach((r,o)=>{const l=t.wtmStats[o];if(l)try{const s=k(l,e);if(!s)return;const a=r.parentElement.querySelector(".B6fmyf")||r.querySelector('div[role="link"]')||r.querySelector("div.UPmit.AP7Wnd");if(!a)return;let c=a.firstElementChild;c&&c.textContent.includes(l.domain)?a.insertBefore(s,c.nextElementSibling):a.appendChild(s)}catch(s){console.warn("Unexpected error while rendering the Tracker Preview wheel",s)}})}),window.addEventListener("message",t=>{if(!(t.origin+"/"!==chrome.runtime.getURL("/").toLowerCase()&&typeof t.data=="string")){if(t.data==="WTMReportClosePopups")m();else if(t.data==="WTMReportDisable")m(),n.forEach(M),chrome.runtime.sendMessage({action:"disableWTMReport"});else if(t.data.startsWith("WTMReportResize")){const r=t.data.split(":")[1];P(r)}}})}}A(chrome.runtime.getURL("/app/templates/trackers-preview.html"))})();

//# sourceMappingURL=trackers_preview_content_script.js.map